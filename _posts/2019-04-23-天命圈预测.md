

```python
import os 
os.chdir("pubg-finish-placement-prediction/")
%pwd
```




    '/Users/liaopeng/spyderworksapce/pubg-finish-placement-prediction'




```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import itertools
import gc
import os
import sys

sns.set_style('darkgrid')
sns.set_palette('bone')

#pd.options.display.float_format = '{:.5g}'.format
pd.options.display.float_format = '{:,.3f}'.format
```


```python
DBNOs - Number of enemy players knocked.
assists - Number of enemy players this player damaged that were killed by teammates.
boosts - Number of boost items used.
damageDealt - Total damage dealt. Note: Self inflicted damage is subtracted.
headshotKills - Number of enemy players killed with headshots.
heals - Number of healing items used.
Id - Player’s Id
killPlace - Ranking in match of number of enemy players killed.
killPoints - Kills-based external ranking of player. (Think of this as an Elo ranking where only kills matter.) If there is a value other than -1 in rankPoints, then any 0 in killPoints should be treated as a “None”.
killStreaks - Max number of enemy players killed in a short amount of time.
kills - Number of enemy players killed.
longestKill - Longest distance between player and player killed at time of death. This may be misleading, as downing a player and driving away may lead to a large longestKill stat.
matchDuration - Duration of match in seconds.
matchId - ID to identify match. There are no matches that are in both the training and testing set.
matchType - String identifying the game mode that the data comes from. The standard modes are “solo”, “duo”, “squad”, “solo-fpp”, “duo-fpp”, and “squad-fpp”; other modes are from events or custom matches.
rankPoints - Elo-like ranking of player. This ranking is inconsistent and is being deprecated in the API’s next version, so use with caution. Value of -1 takes place of “None”.
revives - Number of times this player revived teammates.
rideDistance - Total distance traveled in vehicles measured in meters.
roadKills - Number of kills while in a vehicle.
swimDistance - Total distance traveled by swimming measured in meters.
teamKills - Number of times this player killed a teammate.
vehicleDestroys - Number of vehicles destroyed.
walkDistance - Total distance traveled on foot measured in meters.
weaponsAcquired - Number of weapons picked up.
winPoints - Win-based external ranking of player. (Think of this as an Elo ranking where only winning matters.) If there is a value other than -1 in rankPoints, then any 0 in winPoints should be treated as a “None”.
groupId - ID to identify a group within a match. If the same group of players plays in different matches, they will have a different groupId each time.
numGroups - Number of groups we have data for in the match.
maxPlace - Worst placement we have data for in the match. This may not match with numGroups, as sometimes the data skips over placements.
winPlacePerc - The target of prediction. This is a percentile winning placement, where 1 corresponds to 1st place, and 0 corresponds to last place in the match. It is calculated off of maxPlace, not numGroups, so it is possible to have missing chunks in a match.
```


```python
def toTapleList(list1,list2):
    return list(itertools.product(list1,list2))
# Memory saving function credit to https://www.kaggle.com/gemartin/load-data-reduce-memory-usage
def reduce_mem_usage(df):
    """ iterate through all the columns of a dataframe and modify the data type
        to reduce memory usage.
    """
    start_mem = df.memory_usage().sum() / 1024**2
    
    for col in df.columns:
        col_type = df[col].dtype
        
        if col_type != object:
            c_min = df[col].min()
            c_max = df[col].max()
            if str(col_type)[:3] == 'int':
                if c_min > np.iinfo(np.int8).min and c_max < np.iinfo(np.int8).max:
                    df[col] = df[col].astype(np.int8)
                elif c_min > np.iinfo(np.int16).min and c_max < np.iinfo(np.int16).max:
                    df[col] = df[col].astype(np.int16)
                elif c_min > np.iinfo(np.int32).min and c_max < np.iinfo(np.int32).max:
                    df[col] = df[col].astype(np.int32)
                elif c_min > np.iinfo(np.int64).min and c_max < np.iinfo(np.int64).max:
                    df[col] = df[col].astype(np.int64)  
            else:
                                #if c_min > np.finfo(np.float16).min and c_max < np.finfo(np.float16).max:
                #    df[col] = df[col].astype(np.float16)
                #el
                if c_min > np.finfo(np.float32).min and c_max < np.finfo(np.float32).max:
                    df[col] = df[col].astype(np.float32)
                else:
                    df[col] = df[col].astype(np.float64)
        #else:
            #df[col] = df[col].astype('category')

    end_mem = df.memory_usage().sum() / 1024**2
    print('Memory usage of dataframe is {:.2f} MB --> {:.2f} MB (Decreased by {:.1f}%)'.format(
        start_mem, end_mem, 100 * (start_mem - end_mem) / start_mem))
    return df
```

## Load data


```python
%%time
train = pd.read_csv('train_V2.csv')
train = reduce_mem_usage(train)
test = pd.read_csv('test_V2.csv')
test = reduce_mem_usage(test)
print(train.shape, test.shape)
```

    Memory usage of dataframe is 983.90 MB --> 339.28 MB (Decreased by 65.5%)
    Memory usage of dataframe is 413.18 MB --> 140.19 MB (Decreased by 66.1%)
    (4446966, 29) (1934174, 28)
    CPU times: user 1min 8s, sys: 17.3 s, total: 1min 25s
    Wall time: 2min 11s



```python
train.head(10).T
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Id</th>
      <td>7f96b2f878858a</td>
      <td>eef90569b9d03c</td>
      <td>1eaf90ac73de72</td>
      <td>4616d365dd2853</td>
      <td>315c96c26c9aac</td>
      <td>ff79c12f326506</td>
      <td>95959be0e21ca3</td>
      <td>311b84c6ff4390</td>
      <td>1a68204ccf9891</td>
      <td>e5bb5a43587253</td>
    </tr>
    <tr>
      <th>groupId</th>
      <td>4d4b580de459be</td>
      <td>684d5656442f9e</td>
      <td>6a4a42c3245a74</td>
      <td>a930a9c79cd721</td>
      <td>de04010b3458dd</td>
      <td>289a6836a88d27</td>
      <td>2c485a1ad3d0f1</td>
      <td>eaba5fcb7fc1ae</td>
      <td>47cfbb04e1b1a2</td>
      <td>759bb6f7514fd2</td>
    </tr>
    <tr>
      <th>matchId</th>
      <td>a10357fd1a4a91</td>
      <td>aeb375fc57110c</td>
      <td>110163d8bb94ae</td>
      <td>f1f1f4ef412d7e</td>
      <td>6dc8ff871e21e6</td>
      <td>bac52627a12114</td>
      <td>a8274e903927a2</td>
      <td>292611730ca862</td>
      <td>df014fbee741c6</td>
      <td>3d3031c795305b</td>
    </tr>
    <tr>
      <th>assists</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>boosts</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>damageDealt</th>
      <td>0.000</td>
      <td>91.470</td>
      <td>68.000</td>
      <td>32.900</td>
      <td>100.000</td>
      <td>100.000</td>
      <td>0.000</td>
      <td>8.538</td>
      <td>51.600</td>
      <td>37.270</td>
    </tr>
    <tr>
      <th>DBNOs</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>headshotKills</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>heals</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>killPlace</th>
      <td>60</td>
      <td>57</td>
      <td>47</td>
      <td>75</td>
      <td>45</td>
      <td>44</td>
      <td>96</td>
      <td>48</td>
      <td>64</td>
      <td>74</td>
    </tr>
    <tr>
      <th>killPoints</th>
      <td>1241</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1262</td>
      <td>1000</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>kills</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>killStreaks</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>longestKill</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>58.530</td>
      <td>18.440</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>matchDuration</th>
      <td>1306</td>
      <td>1777</td>
      <td>1318</td>
      <td>1436</td>
      <td>1424</td>
      <td>1395</td>
      <td>1316</td>
      <td>1967</td>
      <td>1375</td>
      <td>1930</td>
    </tr>
    <tr>
      <th>matchType</th>
      <td>squad-fpp</td>
      <td>squad-fpp</td>
      <td>duo</td>
      <td>squad-fpp</td>
      <td>solo-fpp</td>
      <td>squad-fpp</td>
      <td>squad-fpp</td>
      <td>solo-fpp</td>
      <td>squad</td>
      <td>squad</td>
    </tr>
    <tr>
      <th>maxPlace</th>
      <td>28</td>
      <td>26</td>
      <td>50</td>
      <td>31</td>
      <td>97</td>
      <td>28</td>
      <td>28</td>
      <td>96</td>
      <td>28</td>
      <td>29</td>
    </tr>
    <tr>
      <th>numGroups</th>
      <td>26</td>
      <td>25</td>
      <td>47</td>
      <td>30</td>
      <td>95</td>
      <td>28</td>
      <td>28</td>
      <td>92</td>
      <td>27</td>
      <td>27</td>
    </tr>
    <tr>
      <th>rankPoints</th>
      <td>-1</td>
      <td>1484</td>
      <td>1491</td>
      <td>1408</td>
      <td>1560</td>
      <td>1418</td>
      <td>-1</td>
      <td>-1</td>
      <td>1493</td>
      <td>1349</td>
    </tr>
    <tr>
      <th>revives</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>rideDistance</th>
      <td>0.000</td>
      <td>0.004</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>2,004.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>roadKills</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>swimDistance</th>
      <td>0.000</td>
      <td>11.040</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>teamKills</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>vehicleDestroys</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>walkDistance</th>
      <td>244.800</td>
      <td>1,434.000</td>
      <td>161.800</td>
      <td>202.700</td>
      <td>49.750</td>
      <td>34.700</td>
      <td>13.500</td>
      <td>1,089.000</td>
      <td>799.900</td>
      <td>65.670</td>
    </tr>
    <tr>
      <th>weaponsAcquired</th>
      <td>1</td>
      <td>5</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>6</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>winPoints</th>
      <td>1466</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1497</td>
      <td>1500</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>winPlacePerc</th>
      <td>0.444</td>
      <td>0.640</td>
      <td>0.775</td>
      <td>0.167</td>
      <td>0.188</td>
      <td>0.037</td>
      <td>0.000</td>
      <td>0.737</td>
      <td>0.370</td>
      <td>0.214</td>
    </tr>
  </tbody>
</table>
</div>




```python
train.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 4446966 entries, 0 to 4446965
    Data columns (total 29 columns):
    Id                 object
    groupId            object
    matchId            object
    assists            int8
    boosts             int8
    damageDealt        float32
    DBNOs              int8
    headshotKills      int8
    heals              int8
    killPlace          int8
    killPoints         int16
    kills              int8
    killStreaks        int8
    longestKill        float32
    matchDuration      int16
    matchType          object
    maxPlace           int8
    numGroups          int8
    rankPoints         int16
    revives            int8
    rideDistance       float32
    roadKills          int8
    swimDistance       float32
    teamKills          int8
    vehicleDestroys    int8
    walkDistance       float32
    weaponsAcquired    int16
    winPoints          int16
    winPlacePerc       float32
    dtypes: float32(6), int16(5), int8(14), object(4)
    memory usage: 339.3+ MB



```python
null_cnt = train.isnull().sum().sort_values()
print('null count:', null_cnt[null_cnt > 0])
# winPlacePerc has missing data let's drop it
# dropna 
train.dropna(inplace=True)
```

    null count: winPlacePerc    1
    dtype: int64



```python
#参数的意义是只对数值数据进行描述性统计
train.describe(include=np.number).drop('count').T
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>assists</th>
      <td>0.234</td>
      <td>0.589</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>22.000</td>
    </tr>
    <tr>
      <th>boosts</th>
      <td>1.107</td>
      <td>1.716</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>2.000</td>
      <td>33.000</td>
    </tr>
    <tr>
      <th>damageDealt</th>
      <td>130.633</td>
      <td>169.887</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>84.240</td>
      <td>186.000</td>
      <td>6,616.000</td>
    </tr>
    <tr>
      <th>DBNOs</th>
      <td>0.658</td>
      <td>1.146</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
      <td>53.000</td>
    </tr>
    <tr>
      <th>headshotKills</th>
      <td>0.227</td>
      <td>0.602</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>64.000</td>
    </tr>
    <tr>
      <th>heals</th>
      <td>1.370</td>
      <td>2.680</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>2.000</td>
      <td>80.000</td>
    </tr>
    <tr>
      <th>killPlace</th>
      <td>47.599</td>
      <td>27.463</td>
      <td>1.000</td>
      <td>24.000</td>
      <td>47.000</td>
      <td>71.000</td>
      <td>101.000</td>
    </tr>
    <tr>
      <th>killPoints</th>
      <td>505.006</td>
      <td>627.505</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1,172.000</td>
      <td>2,170.000</td>
    </tr>
    <tr>
      <th>kills</th>
      <td>0.925</td>
      <td>1.558</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
      <td>72.000</td>
    </tr>
    <tr>
      <th>killStreaks</th>
      <td>0.544</td>
      <td>0.711</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
      <td>20.000</td>
    </tr>
    <tr>
      <th>longestKill</th>
      <td>22.993</td>
      <td>51.476</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>21.320</td>
      <td>1,094.000</td>
    </tr>
    <tr>
      <th>matchDuration</th>
      <td>1,579.506</td>
      <td>258.740</td>
      <td>9.000</td>
      <td>1,367.000</td>
      <td>1,438.000</td>
      <td>1,851.000</td>
      <td>2,237.000</td>
    </tr>
    <tr>
      <th>maxPlace</th>
      <td>44.505</td>
      <td>23.828</td>
      <td>1.000</td>
      <td>28.000</td>
      <td>30.000</td>
      <td>49.000</td>
      <td>100.000</td>
    </tr>
    <tr>
      <th>numGroups</th>
      <td>43.008</td>
      <td>23.289</td>
      <td>1.000</td>
      <td>27.000</td>
      <td>30.000</td>
      <td>47.000</td>
      <td>100.000</td>
    </tr>
    <tr>
      <th>rankPoints</th>
      <td>892.010</td>
      <td>736.648</td>
      <td>-1.000</td>
      <td>-1.000</td>
      <td>1,443.000</td>
      <td>1,500.000</td>
      <td>5,910.000</td>
    </tr>
    <tr>
      <th>revives</th>
      <td>0.165</td>
      <td>0.472</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>39.000</td>
    </tr>
    <tr>
      <th>rideDistance</th>
      <td>606.092</td>
      <td>1,496.470</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.191</td>
      <td>40,710.000</td>
    </tr>
    <tr>
      <th>roadKills</th>
      <td>0.003</td>
      <td>0.073</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>18.000</td>
    </tr>
    <tr>
      <th>swimDistance</th>
      <td>4.509</td>
      <td>30.238</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>3,823.000</td>
    </tr>
    <tr>
      <th>teamKills</th>
      <td>0.024</td>
      <td>0.167</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>12.000</td>
    </tr>
    <tr>
      <th>vehicleDestroys</th>
      <td>0.008</td>
      <td>0.093</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>5.000</td>
    </tr>
    <tr>
      <th>walkDistance</th>
      <td>1,148.517</td>
      <td>1,180.553</td>
      <td>0.000</td>
      <td>155.100</td>
      <td>685.600</td>
      <td>1,976.000</td>
      <td>25,780.000</td>
    </tr>
    <tr>
      <th>weaponsAcquired</th>
      <td>3.660</td>
      <td>2.457</td>
      <td>0.000</td>
      <td>2.000</td>
      <td>3.000</td>
      <td>5.000</td>
      <td>236.000</td>
    </tr>
    <tr>
      <th>winPoints</th>
      <td>606.460</td>
      <td>739.700</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1,495.000</td>
      <td>2,013.000</td>
    </tr>
    <tr>
      <th>winPlacePerc</th>
      <td>0.473</td>
      <td>0.307</td>
      <td>0.000</td>
      <td>0.200</td>
      <td>0.458</td>
      <td>0.741</td>
      <td>1.000</td>
    </tr>
  </tbody>
</table>
</div>



## Data Analysis

### Id, groupId, matchId


```python
#查看数据有多少个不同值
for c in ['Id','groupId','matchId']:
    print(f'unique [{c}] count:', train[c].nunique())
```

    unique [Id] count: 4446965
    unique [groupId] count: 2026744
    unique [matchId] count: 47964


### matchType
There are 3 game modes in the game. One can play solo, or with a friend (duo), or with 3 other friends (squad).


```python
fig, ax = plt.subplots(1, 2, figsize=(12, 4))
# first 函数使得条形图按照顺序排列
train.groupby('matchId')['matchType'].first().value_counts().plot.bar(ax=ax[0])

'''
solo  <-- solo,solo-fpp,normal-solo,normal-solo-fpp
duo   <-- duo,duo-fpp,normal-duo,normal-duo-fpp,crashfpp,crashtpp
squad <-- squad,squad-fpp,normal-squad,normal-squad-fpp,flarefpp,flaretpp
'''
mapper = lambda x: 'solo' if ('solo' in x) else 'duo' if ('duo' in x) or ('crash' in x) else 'squad'
train['matchType'] = train['matchType'].apply(mapper)
train.groupby('matchId')['matchType'].first().value_counts().plot.bar(ax=ax[1])
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1ab03a2518>




![png](output_14_1.png)


### cause by computer only groups?


```python
print(len(train))
```

    4446966



```python
#numGroups与maxPlace匹配  不匹配
for q in ['numGroups == maxPlace','numGroups != maxPlace']:
    print(q, ':', len(train.query(q)))
# 不匹配的原因大概率是机器人的存在
```

    numGroups == maxPlace : 1241089
    numGroups != maxPlace : 3205876


### groups in match


```python
# describe
cols = ['numGroups','maxPlace']
desc1 = train.groupby('matchType')[cols].describe()[toTapleList(cols,['min','mean','max'])]
# groups in match
group = train.groupby(['matchType','matchId','groupId']).count().groupby(['matchType','matchId']).size().to_frame('groups in match')
desc2 = group.groupby('matchType').describe()[toTapleList(['groups in match'],['min','mean','max'])]

pd.concat([desc1, desc2], axis=1)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">numGroups</th>
      <th colspan="3" halign="left">maxPlace</th>
      <th colspan="3" halign="left">groups in match</th>
    </tr>
    <tr>
      <th></th>
      <th>min</th>
      <th>mean</th>
      <th>max</th>
      <th>min</th>
      <th>mean</th>
      <th>max</th>
      <th>min</th>
      <th>mean</th>
      <th>max</th>
    </tr>
    <tr>
      <th>matchType</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>duo</th>
      <td>1.000</td>
      <td>45.812</td>
      <td>52.000</td>
      <td>3.000</td>
      <td>47.609</td>
      <td>52.000</td>
      <td>1.000</td>
      <td>45.349</td>
      <td>52.000</td>
    </tr>
    <tr>
      <th>solo</th>
      <td>1.000</td>
      <td>91.115</td>
      <td>100.000</td>
      <td>2.000</td>
      <td>93.909</td>
      <td>100.000</td>
      <td>1.000</td>
      <td>85.680</td>
      <td>100.000</td>
    </tr>
    <tr>
      <th>squad</th>
      <td>2.000</td>
      <td>27.039</td>
      <td>37.000</td>
      <td>2.000</td>
      <td>27.983</td>
      <td>37.000</td>
      <td>2.000</td>
      <td>26.835</td>
      <td>37.000</td>
    </tr>
  </tbody>
</table>
</div>



## players

### players in match, group
100 players join the same server, so in the case of duos the max teams are 50 and in the case of squads the max teams are 25.


```python
match = train.groupby(['matchType','matchId']).size().to_frame('players in match')
group = train.groupby(['matchType','matchId','groupId']).size().to_frame('players in group')
pd.concat([match.groupby('matchType').describe()[toTapleList(['players in match'],['min','mean','max'])], 
           group.groupby('matchType').describe()[toTapleList(['players in group'],['min','mean','max'])]], axis=1)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">players in match</th>
      <th colspan="3" halign="left">players in group</th>
    </tr>
    <tr>
      <th></th>
      <th>min</th>
      <th>mean</th>
      <th>max</th>
      <th>min</th>
      <th>mean</th>
      <th>max</th>
    </tr>
    <tr>
      <th>matchType</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>crashfpp</th>
      <td>20.000</td>
      <td>86.123</td>
      <td>100.000</td>
      <td>1.000</td>
      <td>2.009</td>
      <td>10.000</td>
    </tr>
    <tr>
      <th>crashtpp</th>
      <td>59.000</td>
      <td>74.200</td>
      <td>90.000</td>
      <td>1.000</td>
      <td>2.061</td>
      <td>7.000</td>
    </tr>
    <tr>
      <th>duo</th>
      <td>38.000</td>
      <td>93.442</td>
      <td>100.000</td>
      <td>1.000</td>
      <td>2.059</td>
      <td>16.000</td>
    </tr>
    <tr>
      <th>duo-fpp</th>
      <td>7.000</td>
      <td>93.850</td>
      <td>100.000</td>
      <td>1.000</td>
      <td>2.049</td>
      <td>72.000</td>
    </tr>
    <tr>
      <th>flarefpp</th>
      <td>60.000</td>
      <td>79.778</td>
      <td>96.000</td>
      <td>1.000</td>
      <td>3.590</td>
      <td>17.000</td>
    </tr>
    <tr>
      <th>flaretpp</th>
      <td>57.000</td>
      <td>86.379</td>
      <td>97.000</td>
      <td>1.000</td>
      <td>3.604</td>
      <td>18.000</td>
    </tr>
    <tr>
      <th>normal-duo</th>
      <td>8.000</td>
      <td>16.583</td>
      <td>39.000</td>
      <td>1.000</td>
      <td>1.970</td>
      <td>5.000</td>
    </tr>
    <tr>
      <th>normal-duo-fpp</th>
      <td>7.000</td>
      <td>34.741</td>
      <td>98.000</td>
      <td>1.000</td>
      <td>1.950</td>
      <td>7.000</td>
    </tr>
    <tr>
      <th>normal-solo</th>
      <td>6.000</td>
      <td>14.174</td>
      <td>47.000</td>
      <td>1.000</td>
      <td>1.405</td>
      <td>7.000</td>
    </tr>
    <tr>
      <th>normal-solo-fpp</th>
      <td>2.000</td>
      <td>17.521</td>
      <td>58.000</td>
      <td>1.000</td>
      <td>1.371</td>
      <td>10.000</td>
    </tr>
    <tr>
      <th>normal-squad</th>
      <td>13.000</td>
      <td>32.250</td>
      <td>99.000</td>
      <td>1.000</td>
      <td>4.161</td>
      <td>10.000</td>
    </tr>
    <tr>
      <th>normal-squad-fpp</th>
      <td>6.000</td>
      <td>47.972</td>
      <td>95.000</td>
      <td>1.000</td>
      <td>4.348</td>
      <td>74.000</td>
    </tr>
    <tr>
      <th>solo</th>
      <td>11.000</td>
      <td>79.209</td>
      <td>100.000</td>
      <td>1.000</td>
      <td>1.079</td>
      <td>21.000</td>
    </tr>
    <tr>
      <th>solo-fpp</th>
      <td>1.000</td>
      <td>94.517</td>
      <td>100.000</td>
      <td>1.000</td>
      <td>1.025</td>
      <td>64.000</td>
    </tr>
    <tr>
      <th>squad</th>
      <td>18.000</td>
      <td>94.101</td>
      <td>100.000</td>
      <td>1.000</td>
      <td>3.538</td>
      <td>28.000</td>
    </tr>
    <tr>
      <th>squad-fpp</th>
      <td>5.000</td>
      <td>94.541</td>
      <td>100.000</td>
      <td>1.000</td>
      <td>3.470</td>
      <td>31.000</td>
    </tr>
  </tbody>
</table>
</div>



### Too many group players


```python
print(group['players in group'].nlargest(5))
del match,group
```

    matchType  matchId         groupId       
    squad      b30f3d87189aa6  14d6b54cdec6bc    74
    duo        3e029737889ce9  b8275198faa03b    72
    solo       41a634f62f86b7  128b07271aa012    64
    duo        7e93ce71ac6f61  7385e5fe214021    49
    squad      3c2531adf5b942  e52a2e6ca30474    36
    Name: players in group, dtype: int64



```python
''' ex) matchId=='41a634f62f86b7', groupId=='128b07271aa012'
'''
subset = train[train['matchId']=='41a634f62f86b7']
sub_grp = subset[subset['groupId']=='128b07271aa012']

print('matchId==\'41a634f62f86b7\' & groupId==\'128b07271aa012\'')
print('-'*50)
print('players:',len(subset))
print('groups:',subset['groupId'].nunique())
print('numGroups:',subset['numGroups'].unique())
print('maxPlace:',subset['maxPlace'].unique())
print('-'*50)
print('max-group players:',len(sub_grp))
print('max-group winPlacePerc:',sub_grp['winPlacePerc'].unique())
print('-'*50)
print('winPlacePerc:',subset['winPlacePerc'].sort_values().unique())
```

    matchId=='41a634f62f86b7' & groupId=='128b07271aa012'
    --------------------------------------------------
    players: 97
    groups: 34
    numGroups: [34]
    maxPlace: [97]
    --------------------------------------------------
    max-group players: 64
    max-group winPlacePerc: [0.28119999]
    --------------------------------------------------
    winPlacePerc: [0.         0.0104     0.0208     0.0312     0.0417     0.0521
     0.0625     0.0729     0.0833     0.0938     0.1042     0.1146
     0.125      0.1354     0.14579999 0.15620001 0.16670001 0.1771
     0.1875     0.1979     0.20829999 0.21879999 0.22920001 0.2396
     0.25       0.2604     0.27079999 0.28119999 0.7604     0.77079999
     0.89579999 0.91670001 0.9896     1.        ]


### Plot players in group


```python
group = train.groupby(['matchId','groupId','matchType'])['Id'].count().to_frame('players').reset_index()
group.loc[group['players'] > 4, 'players'] = '5+'
group['players'] = group['players'].astype(str)

fig, ax = plt.subplots(1, 3, figsize=(16, 4))
for mt, ax in zip(['solo','duo','squad'], ax.ravel()):
    ax.set_xlabel(mt)
    group[group['matchType'] == mt]['players'].value_counts().sort_index().plot.bar(ax=ax)
```


![png](output_27_0.png)


## matchDuration


```python
fig, ax = plt.subplots(1, 2, figsize=(12, 4))
# there are two types of maps?
train['matchDuration'].hist(bins=50, ax=ax[0])
train.query('matchDuration >= 1400 & matchDuration <= 1800')['matchDuration'].hist(bins=50, ax=ax[1])
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1a1c65ea20>




![png](output_29_1.png)


### min matchDuration


```python
train[train['matchDuration'] == train['matchDuration'].min()].head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>groupId</th>
      <th>matchId</th>
      <th>assists</th>
      <th>boosts</th>
      <th>damageDealt</th>
      <th>DBNOs</th>
      <th>headshotKills</th>
      <th>heals</th>
      <th>killPlace</th>
      <th>...</th>
      <th>revives</th>
      <th>rideDistance</th>
      <th>roadKills</th>
      <th>swimDistance</th>
      <th>teamKills</th>
      <th>vehicleDestroys</th>
      <th>walkDistance</th>
      <th>weaponsAcquired</th>
      <th>winPoints</th>
      <th>winPlacePerc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1206365</th>
      <td>28f2bb56074e95</td>
      <td>311a5a9adf1a96</td>
      <td>e5a77433bc436f</td>
      <td>0</td>
      <td>0</td>
      <td>100.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0.280</td>
      <td>2</td>
      <td>0</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>2109739</th>
      <td>2a5f4f18fe9e86</td>
      <td>f290930a32548a</td>
      <td>e5a77433bc436f</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>2</td>
      <td>0</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 29 columns</p>
</div>



### max matchDuration


```python
train[train['matchDuration'] == train['matchDuration'].max()].head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>groupId</th>
      <th>matchId</th>
      <th>assists</th>
      <th>boosts</th>
      <th>damageDealt</th>
      <th>DBNOs</th>
      <th>headshotKills</th>
      <th>heals</th>
      <th>killPlace</th>
      <th>...</th>
      <th>revives</th>
      <th>rideDistance</th>
      <th>roadKills</th>
      <th>swimDistance</th>
      <th>teamKills</th>
      <th>vehicleDestroys</th>
      <th>walkDistance</th>
      <th>weaponsAcquired</th>
      <th>winPoints</th>
      <th>winPlacePerc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>130663</th>
      <td>8089c9ef1fa09e</td>
      <td>3c909156e89431</td>
      <td>f8e02cb4c82d7d</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>72</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>231.800</td>
      <td>3</td>
      <td>0</td>
      <td>0.260</td>
    </tr>
    <tr>
      <th>139317</th>
      <td>3049d51e07bab3</td>
      <td>4086a790e99513</td>
      <td>f8e02cb4c82d7d</td>
      <td>0</td>
      <td>0</td>
      <td>100.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>34</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>696.000</td>
      <td>7</td>
      <td>0</td>
      <td>0.458</td>
    </tr>
    <tr>
      <th>146220</th>
      <td>cb3902c30f688c</td>
      <td>65400d5cf84ead</td>
      <td>f8e02cb4c82d7d</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>85</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>99.950</td>
      <td>1</td>
      <td>0</td>
      <td>0.125</td>
    </tr>
    <tr>
      <th>246201</th>
      <td>80e022ce3a64ff</td>
      <td>b668e37229bb2d</td>
      <td>f8e02cb4c82d7d</td>
      <td>0</td>
      <td>1</td>
      <td>96.250</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>35</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>1,395.000</td>
      <td>6</td>
      <td>0</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>268239</th>
      <td>0e50a3a859d3ab</td>
      <td>9dcca2c1beb072</td>
      <td>f8e02cb4c82d7d</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>41</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>121.700</td>
      <td>3</td>
      <td>0</td>
      <td>0.906</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 29 columns</p>
</div>



### same match is same duration


```python
(train.groupby('matchId')['matchDuration'].nunique() > 1).any()
```




    False



## boosts, heals


```python
fig, ax = plt.subplots(2, 2, figsize=(16, 8))

cols = ['boosts','heals']
for col, ax in zip(cols, ax):
    sub = train[['winPlacePerc',col]].copy()
    mv = (sub[col].max() // 5) + 1
    sub[col] = pd.cut(sub[col], [5*x for x in range(0,mv)], right=False)
    sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
    train[col].hist(bins=20, ax=ax[1])
```


![png](output_37_0.png)


## revives


```python
print('solo player has revives:', 'solo' in train.query('revives > 0')['matchType'].unique())
```

    solo player has revives: False



```python
fig, ax = plt.subplots(1, 2, figsize=(16, 4))
col = 'revives'
sub = train.loc[~train['matchType'].str.contains('solo'),['winPlacePerc',col]].copy()
sub[col] = pd.cut(sub[col], [5*x for x in range(0,8)], right=False)
sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
train[col].hist(bins=20, ax=ax[1])
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1a1e1e41d0>




![png](output_40_1.png)


## killPlace


```python
train.groupby(['matchType'])['killPlace'].describe()[['min','mean','max']]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>min</th>
      <th>mean</th>
      <th>max</th>
    </tr>
    <tr>
      <th>matchType</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>duo</th>
      <td>1.000</td>
      <td>47.471</td>
      <td>100.000</td>
    </tr>
    <tr>
      <th>solo</th>
      <td>1.000</td>
      <td>47.458</td>
      <td>100.000</td>
    </tr>
    <tr>
      <th>squad</th>
      <td>1.000</td>
      <td>47.712</td>
      <td>101.000</td>
    </tr>
  </tbody>
</table>
</div>




```python
plt.figure(figsize=(8,4))
col = 'killPlace'
sub = train[['winPlacePerc',col]].copy()
sub[col] = pd.cut(sub[col], [10*x for x in range(0,11)], right=False)
sub.groupby(col).mean()['winPlacePerc'].plot.bar()
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1a1e1f7d30>




![png](output_43_1.png)


### killPlace is a sorted ranking of kills and winPlacePerc in each match


```python
''' important 
'''
subMatch = train[train['matchId'] == train['matchId'].min()].sort_values(['winPlacePerc','killPlace'])
cols = ['groupId','kills','winPlacePerc','killPlace']
subMatch[cols]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>groupId</th>
      <th>kills</th>
      <th>winPlacePerc</th>
      <th>killPlace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3895898</th>
      <td>3a6addfa0df938</td>
      <td>0</td>
      <td>0.000</td>
      <td>94</td>
    </tr>
    <tr>
      <th>3599150</th>
      <td>3a6addfa0df938</td>
      <td>0</td>
      <td>0.000</td>
      <td>95</td>
    </tr>
    <tr>
      <th>4367296</th>
      <td>236ab9e9c081b9</td>
      <td>0</td>
      <td>0.037</td>
      <td>88</td>
    </tr>
    <tr>
      <th>4131025</th>
      <td>236ab9e9c081b9</td>
      <td>0</td>
      <td>0.037</td>
      <td>89</td>
    </tr>
    <tr>
      <th>3088817</th>
      <td>236ab9e9c081b9</td>
      <td>0</td>
      <td>0.037</td>
      <td>90</td>
    </tr>
    <tr>
      <th>2290792</th>
      <td>236ab9e9c081b9</td>
      <td>0</td>
      <td>0.037</td>
      <td>91</td>
    </tr>
    <tr>
      <th>1998699</th>
      <td>236ab9e9c081b9</td>
      <td>0</td>
      <td>0.037</td>
      <td>92</td>
    </tr>
    <tr>
      <th>1425950</th>
      <td>236ab9e9c081b9</td>
      <td>0</td>
      <td>0.037</td>
      <td>93</td>
    </tr>
    <tr>
      <th>329124</th>
      <td>e8ff1c0fe7f6aa</td>
      <td>0</td>
      <td>0.074</td>
      <td>84</td>
    </tr>
    <tr>
      <th>729840</th>
      <td>e8ff1c0fe7f6aa</td>
      <td>0</td>
      <td>0.074</td>
      <td>85</td>
    </tr>
    <tr>
      <th>609078</th>
      <td>e8ff1c0fe7f6aa</td>
      <td>0</td>
      <td>0.074</td>
      <td>86</td>
    </tr>
    <tr>
      <th>3961031</th>
      <td>e8ff1c0fe7f6aa</td>
      <td>0</td>
      <td>0.074</td>
      <td>87</td>
    </tr>
    <tr>
      <th>134000</th>
      <td>97364d4199bf30</td>
      <td>0</td>
      <td>0.111</td>
      <td>78</td>
    </tr>
    <tr>
      <th>4064127</th>
      <td>97364d4199bf30</td>
      <td>0</td>
      <td>0.111</td>
      <td>79</td>
    </tr>
    <tr>
      <th>3557894</th>
      <td>97364d4199bf30</td>
      <td>0</td>
      <td>0.111</td>
      <td>80</td>
    </tr>
    <tr>
      <th>2876513</th>
      <td>97364d4199bf30</td>
      <td>0</td>
      <td>0.111</td>
      <td>81</td>
    </tr>
    <tr>
      <th>2368895</th>
      <td>97364d4199bf30</td>
      <td>0</td>
      <td>0.111</td>
      <td>82</td>
    </tr>
    <tr>
      <th>2043479</th>
      <td>97364d4199bf30</td>
      <td>0</td>
      <td>0.111</td>
      <td>83</td>
    </tr>
    <tr>
      <th>2850875</th>
      <td>dc8f83946f97a9</td>
      <td>0</td>
      <td>0.148</td>
      <td>75</td>
    </tr>
    <tr>
      <th>3996954</th>
      <td>dc8f83946f97a9</td>
      <td>0</td>
      <td>0.148</td>
      <td>76</td>
    </tr>
    <tr>
      <th>1136390</th>
      <td>dc8f83946f97a9</td>
      <td>0</td>
      <td>0.148</td>
      <td>77</td>
    </tr>
    <tr>
      <th>90709</th>
      <td>909fe185a8cdec</td>
      <td>1</td>
      <td>0.185</td>
      <td>34</td>
    </tr>
    <tr>
      <th>3924168</th>
      <td>909fe185a8cdec</td>
      <td>1</td>
      <td>0.185</td>
      <td>35</td>
    </tr>
    <tr>
      <th>1847687</th>
      <td>909fe185a8cdec</td>
      <td>0</td>
      <td>0.185</td>
      <td>71</td>
    </tr>
    <tr>
      <th>2841348</th>
      <td>909fe185a8cdec</td>
      <td>0</td>
      <td>0.185</td>
      <td>72</td>
    </tr>
    <tr>
      <th>485219</th>
      <td>909fe185a8cdec</td>
      <td>0</td>
      <td>0.185</td>
      <td>73</td>
    </tr>
    <tr>
      <th>2082031</th>
      <td>909fe185a8cdec</td>
      <td>0</td>
      <td>0.185</td>
      <td>74</td>
    </tr>
    <tr>
      <th>3573456</th>
      <td>e84bd83822d783</td>
      <td>4</td>
      <td>0.222</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1535038</th>
      <td>e84bd83822d783</td>
      <td>2</td>
      <td>0.222</td>
      <td>22</td>
    </tr>
    <tr>
      <th>3372754</th>
      <td>e84bd83822d783</td>
      <td>0</td>
      <td>0.222</td>
      <td>69</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7931</th>
      <td>7bd08592bb25e2</td>
      <td>0</td>
      <td>0.667</td>
      <td>41</td>
    </tr>
    <tr>
      <th>3488471</th>
      <td>7bd08592bb25e2</td>
      <td>0</td>
      <td>0.667</td>
      <td>42</td>
    </tr>
    <tr>
      <th>3253562</th>
      <td>7bd08592bb25e2</td>
      <td>0</td>
      <td>0.667</td>
      <td>43</td>
    </tr>
    <tr>
      <th>1333814</th>
      <td>7bd08592bb25e2</td>
      <td>0</td>
      <td>0.667</td>
      <td>44</td>
    </tr>
    <tr>
      <th>1330902</th>
      <td>6c44ef4381fe8d</td>
      <td>6</td>
      <td>0.704</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3832684</th>
      <td>6c44ef4381fe8d</td>
      <td>2</td>
      <td>0.704</td>
      <td>17</td>
    </tr>
    <tr>
      <th>4124552</th>
      <td>6c44ef4381fe8d</td>
      <td>2</td>
      <td>0.704</td>
      <td>18</td>
    </tr>
    <tr>
      <th>1159129</th>
      <td>b947dfc5cf2d02</td>
      <td>1</td>
      <td>0.741</td>
      <td>28</td>
    </tr>
    <tr>
      <th>518453</th>
      <td>b947dfc5cf2d02</td>
      <td>0</td>
      <td>0.741</td>
      <td>39</td>
    </tr>
    <tr>
      <th>2785098</th>
      <td>6620b219ed2ee2</td>
      <td>2</td>
      <td>0.778</td>
      <td>15</td>
    </tr>
    <tr>
      <th>3737125</th>
      <td>6620b219ed2ee2</td>
      <td>2</td>
      <td>0.778</td>
      <td>16</td>
    </tr>
    <tr>
      <th>2251382</th>
      <td>6620b219ed2ee2</td>
      <td>0</td>
      <td>0.778</td>
      <td>37</td>
    </tr>
    <tr>
      <th>1185914</th>
      <td>6620b219ed2ee2</td>
      <td>0</td>
      <td>0.778</td>
      <td>38</td>
    </tr>
    <tr>
      <th>1311431</th>
      <td>bf80d0d49c12dc</td>
      <td>2</td>
      <td>0.815</td>
      <td>14</td>
    </tr>
    <tr>
      <th>116020</th>
      <td>a572193b2af137</td>
      <td>7</td>
      <td>0.852</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2929488</th>
      <td>a572193b2af137</td>
      <td>4</td>
      <td>0.852</td>
      <td>9</td>
    </tr>
    <tr>
      <th>799262</th>
      <td>a572193b2af137</td>
      <td>1</td>
      <td>0.852</td>
      <td>27</td>
    </tr>
    <tr>
      <th>2313767</th>
      <td>c0f2e306380d3c</td>
      <td>2</td>
      <td>0.889</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4367691</th>
      <td>c0f2e306380d3c</td>
      <td>1</td>
      <td>0.889</td>
      <td>25</td>
    </tr>
    <tr>
      <th>3852802</th>
      <td>c0f2e306380d3c</td>
      <td>1</td>
      <td>0.889</td>
      <td>26</td>
    </tr>
    <tr>
      <th>2782793</th>
      <td>c0f2e306380d3c</td>
      <td>0</td>
      <td>0.889</td>
      <td>36</td>
    </tr>
    <tr>
      <th>869835</th>
      <td>e3c34468e32d8c</td>
      <td>4</td>
      <td>0.926</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2437212</th>
      <td>e3c34468e32d8c</td>
      <td>4</td>
      <td>0.926</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2858339</th>
      <td>e3c34468e32d8c</td>
      <td>3</td>
      <td>0.926</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2075379</th>
      <td>ca058240046b4c</td>
      <td>6</td>
      <td>0.963</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1303528</th>
      <td>ca058240046b4c</td>
      <td>6</td>
      <td>0.963</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3637258</th>
      <td>ca058240046b4c</td>
      <td>5</td>
      <td>0.963</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2351120</th>
      <td>ca058240046b4c</td>
      <td>1</td>
      <td>0.963</td>
      <td>24</td>
    </tr>
    <tr>
      <th>2848198</th>
      <td>4d1bbbc19b9084</td>
      <td>5</td>
      <td>1.000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>20251</th>
      <td>4d1bbbc19b9084</td>
      <td>1</td>
      <td>1.000</td>
      <td>23</td>
    </tr>
  </tbody>
</table>
<p>95 rows × 4 columns</p>
</div>



### kills


```python
fig, ax = plt.subplots(1, 2, figsize=(16, 4))

col = 'kills'
sub = train[['winPlacePerc',col]].copy()
sub[col] = pd.cut(sub[col], [5*x for x in range(0,20)], right=False)
sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
train[train['kills'] < 20][col].hist(bins=20, ax=ax[1])
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1a1d439240>




![png](output_47_1.png)


### kills summary of match


```python
sub = train['matchType'].str.contains('solo')
pd.concat([train.loc[sub].groupby('matchId')['kills'].sum().describe(),
         train.loc[~sub].groupby('matchId')['kills'].sum().describe()], keys=['solo','team'], axis=1).T
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>solo</th>
      <td>8,094.000</td>
      <td>83.421</td>
      <td>27.592</td>
      <td>0.000</td>
      <td>84.000</td>
      <td>89.000</td>
      <td>92.000</td>
      <td>786.000</td>
    </tr>
    <tr>
      <th>team</th>
      <td>39,870.000</td>
      <td>86.212</td>
      <td>17.269</td>
      <td>0.000</td>
      <td>83.000</td>
      <td>87.000</td>
      <td>90.000</td>
      <td>687.000</td>
    </tr>
  </tbody>
</table>
</div>



## killStreaks, DBNOs


```python
fig, ax = plt.subplots(2, 2, figsize=(16, 8))

cols = ['killStreaks','DBNOs']
for col, ax in zip(cols, ax):
    sub = train[['winPlacePerc',col]].copy()
    sub[col] = pd.cut(sub[col], 6)
    sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
    train[col].hist(bins=20, ax=ax[1])
```


![png](output_51_0.png)


## headshotKills, roadKills, teamKills


```python
fig, ax = plt.subplots(3, 2, figsize=(16, 12))

cols = ['headshotKills','roadKills','teamKills']
for col, ax in zip(cols, ax):
    sub = train[['winPlacePerc',col]].copy()
    sub.loc[sub[col] >= 5, col] = '5+'  
    sub[col] = sub[col].astype(str)
    sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
    train[col].hist(bins=20, ax=ax[1])
```


![png](output_53_0.png)


## assists


```python
fig, ax = plt.subplots(1, 2, figsize=(16, 4))

col = 'assists'
sub = train[['winPlacePerc',col]].copy()
sub.loc[sub[col] >= 5, col] = '5+'  
sub[col] = sub[col].astype(str)
sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
train[col].hist(bins=20, ax=ax[1])
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1a463a4eb8>




![png](output_55_1.png)



```python
pd.concat([train[train['matchType'] == 'solo'].describe()['assists'],
           train[train['matchType'] != 'solo'].describe()['assists']],
          keys=['solo','team'], axis=1).T
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>solo</th>
      <td>720,712.000</td>
      <td>0.062</td>
      <td>0.298</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>22.000</td>
    </tr>
    <tr>
      <th>team</th>
      <td>3,726,253.000</td>
      <td>0.267</td>
      <td>0.624</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>17.000</td>
    </tr>
  </tbody>
</table>
</div>



## longestKill


```python
fig, ax = plt.subplots(1, 2, figsize=(16, 4))

col = 'longestKill'
sub = train[['winPlacePerc',col]].copy()
sub[col] = pd.cut(sub[col], 6)
sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
train[col].hist(bins=20, ax=ax[1])
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1a454f53c8>




![png](output_58_1.png)


## damageDealt


```python
fig, ax = plt.subplots(1, 2, figsize=(16, 4))

col = 'damageDealt'
sub = train[['winPlacePerc',col]].copy()
sub[col] = pd.cut(sub[col], 6)
sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
train[col].hist(bins=20, ax=ax[1])
```




    <matplotlib.axes._subplots.AxesSubplot at 0x1a1f1bb198>




![png](output_60_1.png)


what this mean?


```python
train.query('damageDealt == 0 & (kills > 0 | DBNOs > 0)')[
    ['damageDealt','kills','DBNOs','headshotKills','roadKills','teamKills']].head(20)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>damageDealt</th>
      <th>kills</th>
      <th>DBNOs</th>
      <th>headshotKills</th>
      <th>roadKills</th>
      <th>teamKills</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>150</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>589</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>707</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>892</th>
      <td>0.000</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>942</th>
      <td>0.000</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>949</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1011</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1468</th>
      <td>0.000</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1625</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2111</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2356</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2411</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2448</th>
      <td>0.000</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2822</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2837</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2849</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2850</th>
      <td>0.000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2984</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3011</th>
      <td>0.000</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3042</th>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



## walkDistance, rideDistance, swimDistance¶


```python
fig, ax = plt.subplots(3, 2, figsize=(16, 12))

cols = ['walkDistance', 'rideDistance', 'swimDistance']
for col, ax in zip(cols, ax):
    sub = train[['winPlacePerc',col]].copy()
    sub[col] = pd.cut(sub[col], 6)
    sub.groupby(col).mean()['winPlacePerc'].plot.bar(ax=ax[0])
    train[col].hist(bins=20, ax=ax[1])
```


![png](output_64_0.png)



```python
sub = train[['walkDistance','rideDistance','swimDistance','winPlacePerc']].copy()
walk = train['walkDistance']
sub['walkDistanceBin'] = pd.cut(walk, [0, 0.001, walk.quantile(.25), walk.quantile(.5), walk.quantile(.75), 99999])
sub['rideDistanceBin'] = (train['rideDistance'] > 0).astype(int)
sub['swimDistanceBin'] = (train['swimDistance'] > 0).astype(int)

fig, ax = plt.subplots(1, 3, figsize=(16, 3), sharey=True)
sub.groupby('walkDistanceBin').mean()['winPlacePerc'].plot.bar(ax=ax[0])
sub.groupby('rideDistanceBin').mean()['winPlacePerc'].plot.bar(ax=ax[1])
sub.groupby('swimDistanceBin').mean()['winPlacePerc'].plot.bar(ax=ax[2])
del sub, walk
```


![png](output_65_0.png)


zombie


```python
# zombie
sub = train.query('walkDistance == 0 & kills == 0 & weaponsAcquired == 0 & \'solo\' in matchType')
print('count:', len(sub), ' winPlacePerc:', round(sub['winPlacePerc'].mean(),3))
```

    count: 18154  winPlacePerc: 0.053


cheater?


```python
sq = 'kills > 3 & (headshotKills / kills) >= 0.8'
sub = train.query(sq)
print(sq, '\n count:', len(sub), ' winPlacePerc:', round(sub['winPlacePerc'].mean(),3))
```

    kills > 3 & (headshotKills / kills) >= 0.8 
     count: 3859  winPlacePerc: 0.824


## killPoints, rankPoints, winPoints


```python
fig, ax = plt.subplots(1, 3, figsize=(16, 4), sharey=True)

cols = ['killPoints','rankPoints','winPoints']
for col, ax in zip(cols, ax.ravel()): 
    train.plot.scatter(x=col, y='winPlacePerc', ax=ax)
```

    'c' argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with 'x' & 'y'.  Please use a 2-D array with a single row if you really want to specify the same RGB or RGBA value for all points.
    'c' argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with 'x' & 'y'.  Please use a 2-D array with a single row if you really want to specify the same RGB or RGBA value for all points.
    'c' argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with 'x' & 'y'.  Please use a 2-D array with a single row if you really want to specify the same RGB or RGBA value for all points.



```python
# rankPoint: being deprecated
# killPoints,winPoints: If there is a value other than -1 in rankPoints, then any 0 should be treated as a “None”.
sign = lambda x: 'p<=0' if x <= 0 else 'p>0'
pd.concat([
    pd.crosstab(train['rankPoints'].apply(sign), train['winPoints'].apply(sign), margins=False),
    pd.crosstab(train['rankPoints'].apply(sign), train['killPoints'].apply(sign), margins=False)
], keys=['winPoints','killPoints'], axis=1)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">winPoints</th>
      <th colspan="2" halign="left">killPoints</th>
    </tr>
    <tr>
      <th>winPoints</th>
      <th>p&lt;=0</th>
      <th>p&gt;0</th>
      <th>p&lt;=0</th>
      <th>p&gt;0</th>
    </tr>
    <tr>
      <th>rankPoints</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>p&lt;=0</th>
      <td>0</td>
      <td>1791319</td>
      <td>0</td>
      <td>1791319</td>
    </tr>
    <tr>
      <th>p&gt;0</th>
      <td>2655647</td>
      <td>0</td>
      <td>2655647</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>



## winPlacePerc


```python
train['winPlacePerc'].describe()
```




    count   4,446,965.000
    mean            0.473
    std             0.307
    min             0.000
    25%             0.200
    50%             0.458
    75%             0.741
    max             1.000
    Name: winPlacePerc, dtype: float64




```python
# confirm unique winPlace in group
#nuniquePlace = train.groupby(['matchId','groupId'])['winPlacePerc'].nunique()
#print('not unique winPlace in group:', len(nuniquePlace[nuniquePlace > 1]))
#del nuniquePlace
```


```python
print('match count:', train['matchId'].nunique())

# not contains 1st place
maxPlacePerc = train.groupby('matchId')['winPlacePerc'].max()
print('match [not contains 1st place]:', len(maxPlacePerc[maxPlacePerc != 1]))
del maxPlacePerc

# edge case
sub = train[(train['maxPlace'] > 1) & (train['numGroups'] == 1)]
print('match [maxPlace>1 & numGroups==1]:', len(sub.groupby('matchId')))
print(' - unique winPlacePerc:', sub['winPlacePerc'].unique())
```

    match count: 47965
    match [not contains 1st place]: 75
    match [maxPlace>1 & numGroups==1]: 68
     - unique winPlacePerc: [0.]



```python
pd.concat([train[train['winPlacePerc'] == 1].head(5),
           train[train['winPlacePerc'] == 0].head(5)],
          keys=['winPlacePerc_1', 'winPlacePerc_0'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Id</th>
      <th>groupId</th>
      <th>matchId</th>
      <th>assists</th>
      <th>boosts</th>
      <th>damageDealt</th>
      <th>DBNOs</th>
      <th>headshotKills</th>
      <th>heals</th>
      <th>killPlace</th>
      <th>...</th>
      <th>revives</th>
      <th>rideDistance</th>
      <th>roadKills</th>
      <th>swimDistance</th>
      <th>teamKills</th>
      <th>vehicleDestroys</th>
      <th>walkDistance</th>
      <th>weaponsAcquired</th>
      <th>winPoints</th>
      <th>winPlacePerc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">winPlacePerc_1</th>
      <th>67</th>
      <td>22252be49d4419</td>
      <td>37fa7583da2fa2</td>
      <td>1ce1cb998f75c7</td>
      <td>1</td>
      <td>5</td>
      <td>378.800</td>
      <td>2</td>
      <td>3</td>
      <td>6</td>
      <td>4</td>
      <td>...</td>
      <td>0</td>
      <td>317.700</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>1</td>
      <td>3,120.000</td>
      <td>4</td>
      <td>0</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>107</th>
      <td>7970b4ea89e81e</td>
      <td>abf9e2780b9f48</td>
      <td>04832cfd74ff30</td>
      <td>1</td>
      <td>1</td>
      <td>58.360</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>38</td>
      <td>...</td>
      <td>0</td>
      <td>5,134.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>2,708.000</td>
      <td>7</td>
      <td>0</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>118</th>
      <td>953577684b828a</td>
      <td>54ce33c41ef9ff</td>
      <td>c5d412db6dbee4</td>
      <td>2</td>
      <td>6</td>
      <td>76.110</td>
      <td>0</td>
      <td>0</td>
      <td>12</td>
      <td>45</td>
      <td>...</td>
      <td>1</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>2,635.000</td>
      <td>7</td>
      <td>0</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>123</th>
      <td>174c758156bcf3</td>
      <td>a935604c9bb7aa</td>
      <td>edc87c8d445823</td>
      <td>1</td>
      <td>9</td>
      <td>626.200</td>
      <td>4</td>
      <td>3</td>
      <td>2</td>
      <td>4</td>
      <td>...</td>
      <td>0</td>
      <td>1,045.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>2,814.000</td>
      <td>7</td>
      <td>1566</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>186</th>
      <td>eb7a3e9f50eca5</td>
      <td>fe3d74f737cd10</td>
      <td>92338c2233be1a</td>
      <td>0</td>
      <td>5</td>
      <td>778.000</td>
      <td>0</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>2,422.000</td>
      <td>5</td>
      <td>1506</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">winPlacePerc_0</th>
      <th>6</th>
      <td>95959be0e21ca3</td>
      <td>2c485a1ad3d0f1</td>
      <td>a8274e903927a2</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>96</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>13.500</td>
      <td>1</td>
      <td>1497</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>29</th>
      <td>ac5b57ff39979c</td>
      <td>857cc55b2b6001</td>
      <td>e019e04dee4f19</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>87</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>62</th>
      <td>eea397f23204bd</td>
      <td>19650a810dbdbf</td>
      <td>b99cd2f850c233</td>
      <td>0</td>
      <td>0</td>
      <td>100.000</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>41</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>9.907</td>
      <td>1</td>
      <td>1514</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>74</th>
      <td>8b3cdbefd1f408</td>
      <td>d25fc68b94f38c</td>
      <td>128c05e4e54c63</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>91</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>27.060</td>
      <td>1</td>
      <td>0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>103</th>
      <td>c4260ce3746cf8</td>
      <td>2e3ce1fb9b7812</td>
      <td>8fb790bb47a1cc</td>
      <td>0</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>94</td>
      <td>...</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0.000</td>
      <td>0</td>
      <td>0</td>
      <td>68.900</td>
      <td>2</td>
      <td>0</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 29 columns</p>
</div>



## match summary


```python
cols = ['kills','teamKills','DBNOs','revives','assists','boosts','heals','damageDealt',
    'walkDistance','rideDistance','swimDistance','weaponsAcquired']

aggs = ['count','min','mean','max']
# summary of solo-match
grp = train.loc[train['matchType'].str.contains('solo')].groupby('matchId')
grpSolo = grp[cols].sum()
# summary of team-match
grp = train.loc[~train['matchType'].str.contains('solo')].groupby('matchId')
grpTeam = grp[cols].sum()

pd.concat([grpSolo.describe().T[aggs], grpTeam.describe().T[aggs]], keys=['solo', 'team'], axis=1)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">solo</th>
      <th colspan="4" halign="left">team</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>min</th>
      <th>mean</th>
      <th>max</th>
      <th>count</th>
      <th>min</th>
      <th>mean</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>kills</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>83.410</td>
      <td>786.000</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>86.212</td>
      <td>687.000</td>
    </tr>
    <tr>
      <th>teamKills</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>1.023</td>
      <td>15.000</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>2.455</td>
      <td>76.000</td>
    </tr>
    <tr>
      <th>DBNOs</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>73.377</td>
      <td>669.000</td>
    </tr>
    <tr>
      <th>revives</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>18.366</td>
      <td>81.000</td>
    </tr>
    <tr>
      <th>assists</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>5.541</td>
      <td>219.000</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>24.954</td>
      <td>275.000</td>
    </tr>
    <tr>
      <th>boosts</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>94.361</td>
      <td>182.000</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>104.302</td>
      <td>227.000</td>
    </tr>
    <tr>
      <th>heals</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>90.291</td>
      <td>395.000</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>134.489</td>
      <td>424.000</td>
    </tr>
    <tr>
      <th>damageDealt</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>10,609.554</td>
      <td>80,991.203</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>12,425.667</td>
      <td>68,960.344</td>
    </tr>
    <tr>
      <th>walkDistance</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>85,056.578</td>
      <td>156,265.719</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>111,468.266</td>
      <td>216,150.875</td>
    </tr>
    <tr>
      <th>rideDistance</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>41,245.410</td>
      <td>207,528.625</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>59,229.430</td>
      <td>370,542.188</td>
    </tr>
    <tr>
      <th>swimDistance</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>452.937</td>
      <td>5,222.350</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>410.993</td>
      <td>9,829.961</td>
    </tr>
    <tr>
      <th>weaponsAcquired</th>
      <td>8,095.000</td>
      <td>0.000</td>
      <td>319.979</td>
      <td>1,860.000</td>
      <td>39,870.000</td>
      <td>0.000</td>
      <td>343.312</td>
      <td>1,666.000</td>
    </tr>
  </tbody>
</table>
</div>




```python
grpSolo.nlargest(5, 'kills')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>kills</th>
      <th>teamKills</th>
      <th>DBNOs</th>
      <th>revives</th>
      <th>assists</th>
      <th>boosts</th>
      <th>heals</th>
      <th>damageDealt</th>
      <th>walkDistance</th>
      <th>rideDistance</th>
      <th>swimDistance</th>
      <th>weaponsAcquired</th>
    </tr>
    <tr>
      <th>matchId</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cfa2775c9ef944</th>
      <td>786.000</td>
      <td>1.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>185.000</td>
      <td>0.000</td>
      <td>395.000</td>
      <td>80,991.203</td>
      <td>15,327.690</td>
      <td>17,631.699</td>
      <td>0.000</td>
      <td>1860</td>
    </tr>
    <tr>
      <th>fe7043ee6221c8</th>
      <td>691.000</td>
      <td>2.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>219.000</td>
      <td>18.000</td>
      <td>53.000</td>
      <td>67,722.703</td>
      <td>19,284.920</td>
      <td>8,599.500</td>
      <td>0.000</td>
      <td>1497</td>
    </tr>
    <tr>
      <th>e024bf51bf1799</th>
      <td>516.000</td>
      <td>3.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>159.000</td>
      <td>0.000</td>
      <td>60.000</td>
      <td>52,742.699</td>
      <td>14,045.650</td>
      <td>7,914.800</td>
      <td>0.000</td>
      <td>1109</td>
    </tr>
    <tr>
      <th>f900de1ec39fa5</th>
      <td>415.000</td>
      <td>1.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>151.000</td>
      <td>0.000</td>
      <td>42.000</td>
      <td>40,134.000</td>
      <td>8,468.610</td>
      <td>8,739.500</td>
      <td>0.000</td>
      <td>877</td>
    </tr>
    <tr>
      <th>5921b55b9e96b5</th>
      <td>387.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>110.000</td>
      <td>0.000</td>
      <td>56.000</td>
      <td>40,473.000</td>
      <td>11,463.260</td>
      <td>4,915.000</td>
      <td>0.000</td>
      <td>837</td>
    </tr>
  </tbody>
</table>
</div>




```python
grpTeam.nlargest(5, 'kills')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>kills</th>
      <th>teamKills</th>
      <th>DBNOs</th>
      <th>revives</th>
      <th>assists</th>
      <th>boosts</th>
      <th>heals</th>
      <th>damageDealt</th>
      <th>walkDistance</th>
      <th>rideDistance</th>
      <th>swimDistance</th>
      <th>weaponsAcquired</th>
    </tr>
    <tr>
      <th>matchId</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6680c7c3d17d48</th>
      <td>687.000</td>
      <td>7.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>232.000</td>
      <td>60.000</td>
      <td>134.000</td>
      <td>65,617.102</td>
      <td>11,311.930</td>
      <td>8,454.950</td>
      <td>0.000</td>
      <td>1558</td>
    </tr>
    <tr>
      <th>8a728def0644be</th>
      <td>656.000</td>
      <td>1.000</td>
      <td>669.000</td>
      <td>35.000</td>
      <td>258.000</td>
      <td>0.000</td>
      <td>277.000</td>
      <td>68,960.344</td>
      <td>27,110.521</td>
      <td>17,190.260</td>
      <td>0.000</td>
      <td>1558</td>
    </tr>
    <tr>
      <th>6bf647ecee30da</th>
      <td>638.000</td>
      <td>12.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>157.000</td>
      <td>1.000</td>
      <td>236.000</td>
      <td>64,173.059</td>
      <td>67,684.250</td>
      <td>33,173.238</td>
      <td>0.000</td>
      <td>1666</td>
    </tr>
    <tr>
      <th>25830709cb9033</th>
      <td>628.000</td>
      <td>3.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>181.000</td>
      <td>0.000</td>
      <td>296.000</td>
      <td>65,856.797</td>
      <td>49,591.730</td>
      <td>32,569.000</td>
      <td>0.000</td>
      <td>1553</td>
    </tr>
    <tr>
      <th>17dea22cefe62a</th>
      <td>583.000</td>
      <td>3.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>181.000</td>
      <td>4.000</td>
      <td>102.000</td>
      <td>61,720.801</td>
      <td>15,640.520</td>
      <td>20,187.859</td>
      <td>0.000</td>
      <td>1348</td>
    </tr>
  </tbody>
</table>
</div>




```python
del grpSolo, grpTeam
```

## group summary


```python
cols = ['kills','teamKills','DBNOs','revives','assists','boosts','heals','damageDealt',
    'walkDistance','rideDistance','swimDistance','weaponsAcquired']
cols.extend(['killPlace','winPlacePerc'])
group = train.groupby(['matchId','groupId'])[cols]

fig, ax = plt.subplots(3, 1, figsize=(12, 18), sharey=True)
for df, ax in zip([group.mean(), group.min(), group.max()], ax.ravel()):
    sns.heatmap(df.corr(), annot=True, linewidths=.6, fmt='.2f', vmax=1, vmin=-1, center=0, cmap='Blues', ax=ax)

del df
```


![png](output_84_0.png)


### any match stats


```python
def printMatchStats(matchIds):
    for mid in matchIds:
        subMatch = train[train['matchId'] == mid]
        print('matchType:', subMatch['matchType'].values[0])

        grp1st = subMatch[subMatch['winPlacePerc'] == 1]
        grpOther = subMatch[subMatch['winPlacePerc'] != 1]
        print('players'.ljust(10), ' total:{:>3}  1st:{:>3}  other:{:>3}'.format(len(subMatch), len(grp1st), len(grpOther)))
        for c in ['kills','teamKills','roadKills','DBNOs','revives','assists']:
            print(c.ljust(10), ' total:{:>3}  1st:{:>3}  other:{:>3}'.format(subMatch[c].sum(), grp1st[c].sum(), grpOther[c].sum()))
        print('-' * 30)
```


```python
match = train.groupby(['matchId'])['Id'].count()
fullplayer = match[match == 100].reset_index()
sampleMid = fullplayer['matchId'][0:5]
printMatchStats(sampleMid)
```

    matchType: duo
    players     total:100  1st:  2  other: 98
    kills       total: 95  1st:  6  other: 89
    teamKills   total:  1  1st:  0  other:  1
    roadKills   total:  0  1st:  0  other:  0
    DBNOs       total: 59  1st:  2  other: 57
    revives     total: 11  1st:  0  other: 11
    assists     total: 22  1st:  0  other: 22
    ------------------------------
    matchType: duo-fpp
    players     total:100  1st:  2  other: 98
    kills       total: 93  1st:  8  other: 85
    teamKills   total:  3  1st:  0  other:  3
    roadKills   total:  0  1st:  0  other:  0
    DBNOs       total: 66  1st:  3  other: 63
    revives     total: 16  1st:  1  other: 15
    assists     total: 22  1st:  3  other: 19
    ------------------------------
    matchType: squad-fpp
    players     total:100  1st:  4  other: 96
    kills       total: 90  1st: 10  other: 80
    teamKills   total:  1  1st:  0  other:  1
    roadKills   total:  0  1st:  0  other:  0
    DBNOs       total: 89  1st:  8  other: 81
    revives     total: 21  1st:  2  other: 19
    assists     total: 35  1st:  6  other: 29
    ------------------------------
    matchType: squad-fpp
    players     total:100  1st:  4  other: 96
    kills       total: 93  1st:  4  other: 89
    teamKills   total:  4  1st:  0  other:  4
    roadKills   total:  0  1st:  0  other:  0
    DBNOs       total: 83  1st:  3  other: 80
    revives     total: 13  1st:  1  other: 12
    assists     total: 24  1st:  1  other: 23
    ------------------------------
    matchType: duo-fpp
    players     total:100  1st:  2  other: 98
    kills       total: 95  1st:  4  other: 91
    teamKills   total:  1  1st:  0  other:  1
    roadKills   total:  0  1st:  0  other:  0
    DBNOs       total: 70  1st:  2  other: 68
    revives     total: 24  1st:  1  other: 23
    assists     total: 17  1st:  1  other: 16
    ------------------------------


## Feature Engineering


```python
all_data = train.append(test, sort=False).reset_index(drop=True)
del train, test
gc.collect()
```




    7



### rank as percent


```python
match = all_data.groupby('matchId')
all_data['killsPerc'] = match['kills'].rank(pct=True).values
all_data['killPlacePerc'] = match['killPlace'].rank(pct=True).values
all_data['walkDistancePerc'] = match['walkDistance'].rank(pct=True).values
#all_data['damageDealtPerc'] = match['damageDealt'].rank(pct=True).values
all_data['walkPerc_killsPerc'] = all_data['walkDistancePerc'] / all_data['killsPerc']

```

### distance


```python
all_data['_totalDistance'] = all_data['rideDistance'] + all_data['walkDistance'] + all_data['swimDistance']
#all_data['_rideBin'] = (all_data['rideDistance'] > 0).astype(int)
#all_data['_swimBin'] = (all_data['swimDistance'] > 0).astype(int)
```

### new feature


```python
def fillInf(df, val):
    numcols = df.select_dtypes(include='number').columns
    cols = numcols[numcols != 'winPlacePerc']
    df[df == np.Inf] = np.NaN
    df[df == np.NINF] = np.NaN
    for c in cols: df[c].fillna(val, inplace=True)
```


```python
all_data['_healthItems'] = all_data['heals'] + all_data['boosts']
all_data['_headshotKillRate'] = all_data['headshotKills'] / all_data['kills']
all_data['_killPlaceOverMaxPlace'] = all_data['killPlace'] / all_data['maxPlace']
all_data['_killsOverWalkDistance'] = all_data['kills'] / all_data['walkDistance']
#all_data['_killsOverDistance'] = all_data['kills'] / all_data['_totalDistance']
#all_data['_walkDistancePerSec'] = all_data['walkDistance'] / all_data['matchDuration']

fillInf(all_data, 0)
```

### drop feature


```python
all_data.drop(['boosts','heals','killStreaks','DBNOs'], axis=1, inplace=True)
all_data.drop(['headshotKills','roadKills','vehicleDestroys'], axis=1, inplace=True)
all_data.drop(['rideDistance','swimDistance','matchDuration'], axis=1, inplace=True)
all_data.drop(['rankPoints','killPoints','winPoints'], axis=1, inplace=True)
```

### grouping
need to predict the order of places for groups within each match.

train on group-level instead of the user-level


```python
match = all_data.groupby(['matchId'])
group = all_data.groupby(['matchId','groupId','matchType'])

# target feature (max, min)
agg_col = list(all_data.columns)
exclude_agg_col = ['Id','matchId','groupId','matchType','maxPlace','numGroups','winPlacePerc']
for c in exclude_agg_col:
    agg_col.remove(c)
print(agg_col)

# target feature (sum)
sum_col = ['kills','killPlace','damageDealt','walkDistance','_healthItems']

```

    ['assists', 'damageDealt', 'killPlace', 'kills', 'longestKill', 'revives', 'teamKills', 'walkDistance', 'weaponsAcquired', 'killsPerc', 'killPlacePerc', 'walkDistancePerc', 'walkPerc_killsPerc', '_totalDistance', '_healthItems', '_headshotKillRate', '_killPlaceOverMaxPlace', '_killsOverWalkDistance']



```python
''' match sum, match max, match mean, group sum
'''
match_data = pd.concat([
    match.size().to_frame('m.players'), 
    match[sum_col].sum().rename(columns=lambda s: 'm.sum.' + s), 
    match[sum_col].max().rename(columns=lambda s: 'm.max.' + s),
    match[sum_col].mean().rename(columns=lambda s: 'm.mean.' + s)
    ], axis=1).reset_index()
match_data = pd.merge(match_data, 
    group[sum_col].sum().rename(columns=lambda s: 'sum.' + s).reset_index())
match_data = reduce_mem_usage(match_data)

print(match_data.shape)
```

    Memory usage of dataframe is 408.37 MB --> 288.92 MB (Decreased by 29.3%)
    (2912983, 24)



```python
''' ranking of kills and killPlace in each match
'''
minKills = all_data.sort_values(['matchId','groupId','kills','killPlace']).groupby(
    ['matchId','groupId','kills']).first().reset_index().copy()
for n in np.arange(4):
    c = 'kills_' + str(n) + '_Place'
    nKills = (minKills['kills'] == n)
    minKills.loc[nKills, c] = minKills[nKills].groupby(['matchId'])['killPlace'].rank().values
    match_data = pd.merge(match_data, minKills[nKills][['matchId','groupId',c]], how='left')
    #match_data[c].fillna(0, inplace=True)
match_data = reduce_mem_usage(match_data)
del minKills, nKills

print(match_data.shape)
```

    Memory usage of dataframe is 377.81 MB --> 333.36 MB (Decreased by 11.8%)
    (2912983, 28)



```python
match_data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>matchId</th>
      <th>m.players</th>
      <th>m.sum.kills</th>
      <th>m.sum.killPlace</th>
      <th>m.sum.damageDealt</th>
      <th>m.sum.walkDistance</th>
      <th>m.sum._healthItems</th>
      <th>m.max.kills</th>
      <th>m.max.killPlace</th>
      <th>m.max.damageDealt</th>
      <th>...</th>
      <th>matchType</th>
      <th>sum.kills</th>
      <th>sum.killPlace</th>
      <th>sum.damageDealt</th>
      <th>sum.walkDistance</th>
      <th>sum._healthItems</th>
      <th>kills_0_Place</th>
      <th>kills_1_Place</th>
      <th>kills_2_Place</th>
      <th>kills_3_Place</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0000a43bce5eec</td>
      <td>95</td>
      <td>90.000</td>
      <td>4,560.000</td>
      <td>13,539.771</td>
      <td>119,082.789</td>
      <td>224.000</td>
      <td>7</td>
      <td>95</td>
      <td>983.700</td>
      <td>...</td>
      <td>squad-fpp</td>
      <td>2.000</td>
      <td>82.000</td>
      <td>219.350</td>
      <td>263.370</td>
      <td>2.000</td>
      <td>13.000</td>
      <td>nan</td>
      <td>6.000</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0000a43bce5eec</td>
      <td>95</td>
      <td>90.000</td>
      <td>4,560.000</td>
      <td>13,539.771</td>
      <td>119,082.789</td>
      <td>224.000</td>
      <td>7</td>
      <td>95</td>
      <td>983.700</td>
      <td>...</td>
      <td>squad-fpp</td>
      <td>0.000</td>
      <td>543.000</td>
      <td>287.930</td>
      <td>119.591</td>
      <td>0.000</td>
      <td>21.000</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0000a43bce5eec</td>
      <td>95</td>
      <td>90.000</td>
      <td>4,560.000</td>
      <td>13,539.771</td>
      <td>119,082.789</td>
      <td>224.000</td>
      <td>7</td>
      <td>95</td>
      <td>983.700</td>
      <td>...</td>
      <td>squad-fpp</td>
      <td>0.000</td>
      <td>189.000</td>
      <td>0.000</td>
      <td>9.636</td>
      <td>0.000</td>
      <td>22.000</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0000a43bce5eec</td>
      <td>95</td>
      <td>90.000</td>
      <td>4,560.000</td>
      <td>13,539.771</td>
      <td>119,082.789</td>
      <td>224.000</td>
      <td>7</td>
      <td>95</td>
      <td>983.700</td>
      <td>...</td>
      <td>squad-fpp</td>
      <td>0.000</td>
      <td>119.000</td>
      <td>23.400</td>
      <td>1,118.100</td>
      <td>1.000</td>
      <td>12.000</td>
      <td>nan</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0000a43bce5eec</td>
      <td>95</td>
      <td>90.000</td>
      <td>4,560.000</td>
      <td>13,539.771</td>
      <td>119,082.789</td>
      <td>224.000</td>
      <td>7</td>
      <td>95</td>
      <td>983.700</td>
      <td>...</td>
      <td>squad-fpp</td>
      <td>6.000</td>
      <td>28.000</td>
      <td>681.900</td>
      <td>6,585.000</td>
      <td>9.000</td>
      <td>nan</td>
      <td>1.000</td>
      <td>nan</td>
      <td>nan</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 28 columns</p>
</div>




```python
''' group mean, max, min
'''
all_data = pd.concat([
    group.size().to_frame('players'),
    group.mean(),
    group[agg_col].max().rename(columns=lambda s: 'max.' + s),
    group[agg_col].min().rename(columns=lambda s: 'min.' + s),
    ], axis=1).reset_index()
all_data = reduce_mem_usage(all_data)

print(all_data.shape)
```

    Memory usage of dataframe is 911.20 MB --> 591.72 MB (Decreased by 35.1%)
    (2912983, 61)


### aggregate feature


```python
numcols = all_data.select_dtypes(include='number').columns.values
numcols = numcols[numcols != 'winPlacePerc']
```


```python
''' match summary, max
'''
all_data = pd.merge(all_data, match_data)
del match_data
gc.collect()

all_data['enemy.players'] = all_data['m.players'] - all_data['players']
for c in sum_col:
    #all_data['enemy.' + c] = (all_data['m.sum.' + c] - all_data['sum.' + c]) / all_data['enemy.players']
    #all_data['p.sum_msum.' + c] = all_data['sum.' + c] / all_data['m.sum.' + c]
    #all_data['p.max_mmean.' + c] = all_data['max.' + c] / all_data['m.mean.' + c]
    all_data['p.max_msum.' + c] = all_data['max.' + c] / all_data['m.sum.' + c]
    all_data['p.max_mmax.' + c] = all_data['max.' + c] / all_data['m.max.' + c]
    all_data.drop(['m.sum.' + c, 'm.max.' + c], axis=1, inplace=True)
    
fillInf(all_data, 0)
print(all_data.shape)
```

    (2912983, 87)



```python
''' match rank
'''
match = all_data.groupby('matchId')
matchRank = match[numcols].rank(pct=True).rename(columns=lambda s: 'rank.' + s)
all_data = reduce_mem_usage(pd.concat([all_data, matchRank], axis=1))
rank_col = matchRank.columns
del matchRank
gc.collect()

# instead of rank(pct=True, method='dense')
match = all_data.groupby('matchId')
matchRank = match[rank_col].max().rename(columns=lambda s: 'max.' + s).reset_index()
all_data = pd.merge(all_data, matchRank)
for c in numcols:
    all_data['rank.' + c] = all_data['rank.' + c] / all_data['max.rank.' + c]
    all_data.drop(['max.rank.' + c], axis=1, inplace=True)
del matchRank
gc.collect()

print(all_data.shape)
```

    Memory usage of dataframe is 2186.32 MB --> 1519.59 MB (Decreased by 30.5%)
    (2912983, 144)


### killPlace rank of group and kills


```python
''' TODO: incomplete
''' 
killMinorRank = all_data[['matchId','min.kills','max.killPlace']].copy()
group = killMinorRank.groupby(['matchId','min.kills'])
killMinorRank['rank.minor.maxKillPlace'] = group.rank(pct=True).values
all_data = pd.merge(all_data, killMinorRank)

killMinorRank = all_data[['matchId','max.kills','min.killPlace']].copy()
group = killMinorRank.groupby(['matchId','max.kills'])
killMinorRank['rank.minor.minKillPlace'] = group.rank(pct=True).values
all_data = pd.merge(all_data, killMinorRank)

del killMinorRank
gc.collect()
```




    70



### delete feature


```python
# drop constant column
constant_column = [col for col in all_data.columns if all_data[col].nunique() == 1]
print('drop columns:', constant_column)
all_data.drop(constant_column, axis=1, inplace=True)
```

    drop columns: ['rank.maxPlace', 'rank.numGroups']


### encode


```python
'''
solo  <-- solo,solo-fpp,normal-solo,normal-solo-fpp
duo   <-- duo,duo-fpp,normal-duo,normal-duo-fpp,crashfpp,crashtpp
squad <-- squad,squad-fpp,normal-squad,normal-squad-fpp,flarefpp,flaretpp
'''
all_data['matchType'] = all_data['matchType'].apply(mapper)

all_data = pd.concat([all_data, pd.get_dummies(all_data['matchType'])], axis=1)
all_data.drop(['matchType'], axis=1, inplace=True)

all_data['matchId'] = all_data['matchId'].apply(lambda x: int(x,16))
all_data['groupId'] = all_data['groupId'].apply(lambda x: int(x,16))
```


```python
null_cnt = all_data.isnull().sum().sort_values()
print(null_cnt[null_cnt > 0])
```

    winPlacePerc    886239
    dtype: int64



```python
#all_data.drop([],axis=1,inplace=True)

cols = [col for col in all_data.columns if col not in ['Id','matchId','groupId']]
for i, t in all_data.loc[:, cols].dtypes.iteritems():
    if t == object:
        all_data[i] = pd.factorize(all_data[i])[0]

all_data = reduce_mem_usage(all_data)
all_data.head()
```

    Memory usage of dataframe is 1527.92 MB --> 1530.70 MB (Decreased by -0.2%)





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>matchId</th>
      <th>groupId</th>
      <th>players</th>
      <th>assists</th>
      <th>damageDealt</th>
      <th>killPlace</th>
      <th>kills</th>
      <th>longestKill</th>
      <th>maxPlace</th>
      <th>numGroups</th>
      <th>...</th>
      <th>rank.min._totalDistance</th>
      <th>rank.min._healthItems</th>
      <th>rank.min._headshotKillRate</th>
      <th>rank.min._killPlaceOverMaxPlace</th>
      <th>rank.min._killsOverWalkDistance</th>
      <th>rank.minor.maxKillPlace</th>
      <th>rank.minor.minKillPlace</th>
      <th>duo</th>
      <th>solo</th>
      <th>squad</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>705378017004</td>
      <td>6950488777545910</td>
      <td>2</td>
      <td>0.000</td>
      <td>109.675</td>
      <td>41.000</td>
      <td>1.000</td>
      <td>6.275</td>
      <td>28.000</td>
      <td>28.000</td>
      <td>...</td>
      <td>0.286</td>
      <td>0.625</td>
      <td>0.500</td>
      <td>0.429</td>
      <td>0.411</td>
      <td>0.591</td>
      <td>1.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>705378017004</td>
      <td>9968970908074425</td>
      <td>6</td>
      <td>0.000</td>
      <td>47.988</td>
      <td>90.500</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>28.000</td>
      <td>28.000</td>
      <td>...</td>
      <td>0.054</td>
      <td>0.286</td>
      <td>0.500</td>
      <td>0.964</td>
      <td>0.411</td>
      <td>0.955</td>
      <td>0.900</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>705378017004</td>
      <td>16443050264754488</td>
      <td>2</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>94.500</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>28.000</td>
      <td>28.000</td>
      <td>...</td>
      <td>0.054</td>
      <td>0.286</td>
      <td>0.500</td>
      <td>1.000</td>
      <td>0.411</td>
      <td>1.000</td>
      <td>1.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>705378017004</td>
      <td>21374959510965402</td>
      <td>2</td>
      <td>0.000</td>
      <td>11.700</td>
      <td>59.500</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>28.000</td>
      <td>28.000</td>
      <td>...</td>
      <td>0.429</td>
      <td>0.286</td>
      <td>0.500</td>
      <td>0.821</td>
      <td>0.411</td>
      <td>0.545</td>
      <td>0.500</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>705378017004</td>
      <td>21704066427752580</td>
      <td>2</td>
      <td>1.000</td>
      <td>340.950</td>
      <td>14.000</td>
      <td>3.000</td>
      <td>25.230</td>
      <td>28.000</td>
      <td>28.000</td>
      <td>...</td>
      <td>0.964</td>
      <td>0.839</td>
      <td>1.000</td>
      <td>0.143</td>
      <td>0.821</td>
      <td>0.333</td>
      <td>1.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 146 columns</p>
</div>



## Predict


```python
X_train = all_data[all_data['winPlacePerc'].notnull()].reset_index(drop=True)
X_test = all_data[all_data['winPlacePerc'].isnull()].drop(['winPlacePerc'], axis=1).reset_index(drop=True)
del all_data
gc.collect()

Y_train = X_train.pop('winPlacePerc')
X_test_grp = X_test[['matchId','groupId']].copy()
train_matchId = X_train['matchId']

# drop matchId,groupId
X_train.drop(['matchId','groupId'], axis=1, inplace=True)
X_test.drop(['matchId','groupId'], axis=1, inplace=True)

print(X_train.shape, X_test.shape)
```

    (2026744, 143) (886239, 143)



```python
print(pd.DataFrame([[val for val in dir()], [sys.getsizeof(eval(val)) for val in dir()]],
                   index=['name','size']).T.sort_values('size', ascending=False).reset_index(drop=True)[:10])
```

                name        size
    0          train  1526267461
    1        X_train  1059987216
    2           test   621315452
    3         X_test   463503101
    4  train_matchId    16214056
    5     X_test_grp    14179928
    6        Y_train     8107080
    7            sub      378274
    8     fullplayer      111810
    9       null_cnt       27653



```python
from sklearn.model_selection import GroupKFold
from sklearn.preprocessing import minmax_scale
import lightgbm as lgb

params={'learning_rate': 0.1,
        'objective':'mae',
        'metric':'mae',
        'num_leaves': 31,
        'verbose': 1,
        'random_state':42,
        'bagging_fraction': 0.7,
        'feature_fraction': 0.7
       }

reg = lgb.LGBMRegressor(**params, n_estimators=10000)
reg.fit(X_train, Y_train)
pred = reg.predict(X_test, num_iteration=reg.best_iteration_)
```


    ---------------------------------------------------------------------------

    OSError                                   Traceback (most recent call last)

    <ipython-input-53-75c16996b142> in <module>
          1 from sklearn.model_selection import GroupKFold
          2 from sklearn.preprocessing import minmax_scale
    ----> 3 import lightgbm as lgb
          4 
          5 params={'learning_rate': 0.1,


    ~/anaconda3/lib/python3.7/site-packages/lightgbm/__init__.py in <module>
          6 from __future__ import absolute_import
          7 
    ----> 8 from .basic import Booster, Dataset
          9 from .callback import (early_stopping, print_evaluation, record_evaluation,
         10                        reset_parameter)


    ~/anaconda3/lib/python3.7/site-packages/lightgbm/basic.py in <module>
         32 
         33 
    ---> 34 _LIB = _load_lib()
         35 
         36 


    ~/anaconda3/lib/python3.7/site-packages/lightgbm/basic.py in _load_lib()
         27     if len(lib_path) == 0:
         28         return None
    ---> 29     lib = ctypes.cdll.LoadLibrary(lib_path[0])
         30     lib.LGBM_GetLastError.restype = ctypes.c_char_p
         31     return lib


    ~/anaconda3/lib/python3.7/ctypes/__init__.py in LoadLibrary(self, name)
        432 
        433     def LoadLibrary(self, name):
    --> 434         return self._dlltype(name)
        435 
        436 cdll = LibraryLoader(CDLL)


    ~/anaconda3/lib/python3.7/ctypes/__init__.py in __init__(self, name, mode, handle, use_errno, use_last_error)
        354 
        355         if handle is None:
    --> 356             self._handle = _dlopen(self._name, mode)
        357         else:
        358             self._handle = handle


    OSError: dlopen(/Users/liaopeng/anaconda3/lib/python3.7/site-packages/lightgbm/lib_lightgbm.so, 6): Library not loaded: /usr/local/opt/libomp/lib/libomp.dylib
      Referenced from: /Users/liaopeng/anaconda3/lib/python3.7/site-packages/lightgbm/lib_lightgbm.so
      Reason: image not found



```python
# Plot feature importance
feature_importance = reg.feature_importances_
feature_importance = 100.0 * (feature_importance / feature_importance.max())
sorted_idx = np.argsort(feature_importance)
sorted_idx = sorted_idx[len(feature_importance) - 30:]
pos = np.arange(sorted_idx.shape[0]) + .5

plt.figure(figsize=(12,8))
plt.barh(pos, feature_importance[sorted_idx], align='center')
plt.yticks(pos, X_train.columns[sorted_idx])
plt.xlabel('Relative Importance')
plt.title('Variable Importance')
plt.show()
```


```python
X_train.columns[np.argsort(-feature_importance)].values
```


```python
X_test_grp['_nofit.winPlacePerc'] = pred

group = X_test_grp.groupby(['matchId'])
X_test_grp['winPlacePerc'] = pred
X_test_grp['_rank.winPlacePerc'] = group['winPlacePerc'].rank(method='min')
X_test = pd.concat([X_test, X_test_grp], axis=1)
```


```python
fullgroup = (X_test['numGroups'] == X_test['maxPlace'])

# full group (201366) --> calculate from rank
subset = X_test.loc[fullgroup]
X_test.loc[fullgroup, 'winPlacePerc'] = (subset['_rank.winPlacePerc'].values - 1) / (subset['maxPlace'].values - 1)

# not full group (684872) --> align with maxPlace
subset = X_test.loc[~fullgroup]
gap = 1.0 / (subset['maxPlace'].values - 1)
new_perc = np.around(subset['winPlacePerc'].values / gap) * gap  # half&up
X_test.loc[~fullgroup, 'winPlacePerc'] = new_perc

X_test['winPlacePerc'] = X_test['winPlacePerc'].clip(lower=0,upper=1)
```


```python
# edge cases
X_test.loc[X_test['maxPlace'] == 0, 'winPlacePerc'] = 0
X_test.loc[X_test['maxPlace'] == 1, 'winPlacePerc'] = 1  # nothing
X_test.loc[(X_test['maxPlace'] > 1) & (X_test['numGroups'] == 1), 'winPlacePerc'] = 0
X_test['winPlacePerc'].describe()
```
